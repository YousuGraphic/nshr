import asyncio
import random
from datetime import datetime
from telethon import TelegramClient
import time

# ุจูุงูุงุช ุงูุญุณุงุจ
API_ID = 22570740
API_HASH = 'e084c2298ab4e048380d960cdfe8d049'
USER_ID = 5590262313
REPORT_CHANNEL = "https://t.me/xox1n"  # ููุงุฉ ุงูุชูุงุฑูุฑ

# ุฅุนุฏุงุฏุงุช ุงููุดุฑ
PUBLISH_INTERVAL = 3600  # ูู ุณุงุนุฉ (ุจุงูุซูุงูู)
LINKS_PUBLISH_INTERVAL = 10800  # ูู 3 ุณุงุนุงุช (ุจุงูุซูุงูู)
LINKS = [
    "https://t.me/+V84P28GntXswYzk0",  # ููุงุฉ ุงูุญุตุฑูุงุช
    "https://t.me/+hygcUTDegyAxMTc0"   # ููุงุฉ ุงูููุงุทุน ุงูุญุตุฑูุฉ
]

# 20 ุตูุบุฉ ุฌุฐุงุจุฉ ููุดุฑ ุงูุจุงูู
BIO_TEXTS = [
    "๐ฅ ุงูุชุดู ุงููุญุชูู ุงูุญุตุฑู ูู ุงูููุงุฉ! ุฑุงุจุท ุงูุงูุถูุงู ูู ุงูุจุงูู ๐",
    "๐ฌ ููุงุทุน ูู ุชุฌุฏูุง ุฅูุง ุนูุฏูุง! ุชูุถู ุจุงูุงูุถูุงู ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ุงูุถู ุฅูู ููุงุชูุง ุงูุญุตุฑูุฉ ูููุตูู ุฅูู ูุญุชูู ูููุฒ! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ูุญุชูู ุญุตุฑู ููุชุธุฑู! ุงุถุบุท ุนูู ุงูุฑุงุจุท ูู ุงูุจุงูู ููุงูุถูุงู ุงูุขู",
    "๐ ููุงุฉ ุฎุงุตุฉ ุจูุญุชูู ูู ุชุฑุงู ูู ุฃู ููุงู ุขุฎุฑ! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ฝ๏ธ ุงุณุชูุชุน ุจุฃูุถู ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงูุถู ุฅูููุง ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ุงุญุตู ุนูู ูุญุชูู ูููุฒ ูููููุง! ุงูุฑุงุจุท ูู ุงูุจุงูู ููุงูุถูุงู",
    "๐๏ธ ุนุฑูุถ ุญุตุฑูุฉ ูููุดุชุฑููู! ุงูุถู ุงูุขู ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ููุงุฉ VIP ููุญุตูู ุนูู ุฃูุถู ุงููุญุชููุงุช! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ฃ ููุงุทุน ุญุตุฑูุฉ ูููุฒุฉ! ุงุถุบุท ุนูู ุงูุฑุงุจุท ูู ุงูุจุงูู ููุงูุถูุงู",
    "๐ ูุฏุงูุง ูุนุฑูุถ ุฎุงุตุฉ ูููุดุชุฑููู! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ฅ๐ฅ ูุญุชูู ุญุตุฑู ููุชุธุฑู! ุงูุถู ุงูุขู ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ูุง ุชููุช ุงููุฑุตุฉ! ูุญุชูู ุญุตุฑู ูู ุงูุชุธุงุฑูุ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ุงุณุชูุชุน ุจุฃูุถู ุงูููุงุทุน! ุงูุถู ุฅูู ููุงุชูุง ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ุชููู! ูุฏููุง ูุง ุชุจุญุซ ุนููุ ุงูุถู ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "โก ุดุญูุงุช ููููุฉ ูู ุงููุญุชูู ุงููููุฒ! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐คฉ ููุงุฌุขุช ุชูุชุธุฑู! ุงูุถู ุฅูู ููุงุชูุง ุงูุญุตุฑูุฉ ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐จ ุฅูุฐุงุฑ ุฃุฎูุฑ! ุงููุฑุตุฉ ุชูุชูู ูุฑูุจูุงุ ุงูุถู ุงูุขู ุนุจุฑ ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ฏ ูุญุชูู ูุณุชุญู ุงููุดุงูุฏุฉ! ุงูุฑุงุจุท ูู ุงูุจุงูู",
    "๐ ุชุฌุฑุจุฉ ูุดุงูุฏุฉ ูุฑูุฏุฉ ุชูุชุธุฑู! ุงูุฑุงุจุท ูู ุงูุจุงูู"
]

# 20 ุตูุบุฉ ุฌุฐุงุจุฉ ูุตุงุญุจุฉ ูุฑุงุจุท ููุงุฉ ุงูุญุตุฑูุงุช (ูุญุชูู ุนุงู)
LINK_TEXTS_1 = [
    "๐ ุงูุถู ุฅูู ููุงุชูุง ุงูุญุตุฑูุฉ ููุดุงูุฏุฉ ุฃูุถู ุงููุญุชููุงุช!",
    "๐ ููุงุฉ VIP ููุญุตูู ุนูู ูุญุชูู ูู ุชุฌุฏู ูู ุฃู ููุงู ุขุฎุฑ!",
    "๐ฅ ูุญุชูู ุญุตุฑู ููุชุธุฑู! ุงูุถู ุงูุขู ููุง ุชููุช ุงููุฑุตุฉ",
    "๐ฌ ุฃูุถู ุงูููุงุทุน ุงูุญุตุฑูุฉ ุชุฌุฏูุง ููุง! ุงุถุบุท ููุงูุถูุงู",
    "๐ ููุงุฉ ุฎุงุตุฉ ุจูุญุชูู ูููุฒ ูููู! ุงูุถู ุฅูููุง ุงูุขู",
    "๐ฃ ููุงุทุน ุญุตุฑูุฉ ูููุฒุฉ! ุงุถุบุท ููุงูุถูุงู ุฅูู ุงูููุงุฉ",
    "๐ ูุฏุงูุง ูุนุฑูุถ ุฎุงุตุฉ ูููุดุชุฑููู ููุท! ุงูุถู ุงูุขู",
    "๐ ูุญุชูู VIP ุจุงูุชุธุงุฑู! ุงุถุบุท ุนูู ุงูุฑุงุจุท ููุงูุถูุงู",
    "๐๏ธ ุนุฑูุถ ุญุตุฑูุฉ ูุง ุชุนูุถ! ุงุถุบุท ููุงูุถูุงู ุงูุขู",
    "๐ ูุง ุชููุช ุงููุฑุตุฉ! ูุญุชูู ูู ุชุฑุงู ุฅูุง ููุง",
    "โก ุดุญูุงุช ููููุฉ ูู ุงููุญุชูู ุงููููุฒ! ุงูุถู ุฅูููุง",
    "๐คฉ ููุงุฌุขุช ุชูุชุธุฑู ูู ููุงุชูุง ุงูุญุตุฑูุฉ! ุงูุถู ุงูุขู",
    "๐จ ุฅูุฐุงุฑ ุฃุฎูุฑ! ุงููุฑุตุฉ ุชูุชูู ูุฑูุจูุงุ ุงูุถู ุงูุขู",
    "๐ ุงุญุชูู ูุนูุง ุจุฃูุถู ุงููุญุชููุงุช! ุงุถุบุท ููุงูุถูุงู",
    "๐ ุงุณุชูุชุน ุจุฃูุถู ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงูุถู ุฅูู ุงูููุงุฉ",
    "๐ ุชููู! ูุฏููุง ูุง ุชุจุญุซ ุนููุ ุงูุถู ุงูุขู",
    "๐ฝ๏ธ ูุญุชูู ุญุตุฑู ุจุงูุชุธุงุฑู! ุงูุถู ุฅูููุง",
    "๐ฏ ูุญุชูู ูุณุชุญู ุงููุดุงูุฏุฉ! ุงูุถู ุงูุขู",
    "๐ ุชุฌุฑุจุฉ ูุดุงูุฏุฉ ูุฑูุฏุฉ ุชูุชุธุฑู!",
    "๐ ุงูุทูู ูู ุฑุญูุฉ ุงููุญุชูู ุงูุญุตุฑู! ุงูุถู ุงูุขู"
]

# 20 ุตูุบุฉ ุฌุฐุงุจุฉ ูุตุงุญุจุฉ ูุฑุงุจุท ููุงุฉ ุงูููุงุทุน ุงูุญุตุฑูุฉ (ุชุฑููุฒ ุนูู ุงูููุงุทุน)
LINK_TEXTS_2 = [
    "๐ฅ ููุงุฉ ุงูููุงุทุน ุงูุญุตุฑูุฉ ุชูุชุญ ุฃุจูุงุจูุง ูู! ุงูุถู ุงูุขู",
    "๐ซ ุงูุชุดู ุนุงูููุง ูู ุงูููุงุทุน ุงูุชู ูู ุชุฑุงูุง ุฅูุง ููุง!",
    "๐ฅ ููุงุทุน ุญุตุฑูุฉ ุชูุชุธุฑู! ุงุถุบุท ููุงูุถูุงู ุฅูู ุงูููุงุฉ",
    "๐ ููุงุฉ ุฎุงุตุฉ ุจุฃุฌูู ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงูุถู ุฅูููุง",
    "๐ฌ ุฃูุถู ุงูููุงุทุน ุงููุฌูุนุฉ ูู ููุงู ูุงุญุฏ! ุงูุถู ุงูุขู",
    "๐ฃ ููุงุทุน ุญุตุฑูุฉ ูููุฒุฉ! ูุง ุชููุช ุงููุฑุตุฉุ ุงูุถู",
    "๐ ูุฏุงูุง ูุนุฑูุถ ุฎุงุตุฉ ููุดุชุฑูู ุงูููุงุฉ ููุท! ุงูุถู",
    "๐ ูุญุชูู VIP ูู ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงุถุบุท ููุงูุถูุงู",
    "๐๏ธ ุนุฑูุถ ุญุตุฑูุฉ ุนูู ุงูููุงุทุน! ุงุถุบุท ููุงูุถูุงู ุงูุขู",
    "๐ ููุงุทุน ูู ุชุฑุงูุง ูู ุฃู ููุงู ุขุฎุฑ! ุงูุถู ุฅูููุง",
    "โก ุดุญูุงุช ููููุฉ ูู ุงูููุงุทุน ุงููููุฒุฉ! ุงูุถู ุงูุขู",
    "๐คฉ ููุงุฌุขุช ููุงุทุน ุชูุชุธุฑู! ุงูุถู ุฅูู ููุงุชูุง ุงูุญุตุฑูุฉ",
    "๐จ ุงููุฑุตุฉ ุงูุฃุฎูุฑุฉ ููุงูุถูุงู! ูุง ุชููุช ุงูููุงุทุน ุงูุญุตุฑูุฉ",
    "๐ ุงุญุชูู ูุนูุง ุจุฃูุถู ุงูููุงุทุน! ุงุถุบุท ููุงูุถูุงู",
    "๐ ุงุณุชูุชุน ุจููุงุทุน ูู ุชูุณุงูุง! ุงูุถู ุฅูู ุงูููุงุฉ",
    "๐ ุชููู! ูุฏููุง ุงูููุงุทุน ุงูุชู ุชุจุญุซ ุนููุงุ ุงูุถู ุงูุขู",
    "๐ฝ๏ธ ููุชุจุฉ ุถุฎูุฉ ูู ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงูุถู ุฅูููุง",
    "๐ฏ ุฃูุถู ุงูููุงุทุน ุงููุฎุชุงุฑุฉ ุชูุชุธุฑู! ุงูุถู ุงูุขู",
    "๐ ุชุฌุฑุจุฉ ูุดุงูุฏุฉ ูุง ุชููุณู! ุงุถุบุท ููุงูุถูุงู",
    "๐ ุงูุทูู ูู ุฑุญูุฉ ุงูููุงุทุน ุงูุญุตุฑูุฉ! ุงูุถู ุงูุขู"
]

class AutoPoster:
    def __init__(self):
        self.client = None
        self.is_running = True
        self.publish_interval = PUBLISH_INTERVAL
        self.links_publish_interval = LINKS_PUBLISH_INTERVAL
        self.report_channel = REPORT_CHANNEL

    async def initialize(self):
        """ุชููุฆุฉ ุงูุนููู"""
        self.client = TelegramClient('userbot_session', API_ID, API_HASH)
        await self.client.start()
        await self.send_report("โ ุชู ุชุดุบูู ุงูููุฒุฑ ุจูุช ุจูุฌุงุญ!")
        print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - ุชู ุชุดุบูู ุงูููุฒุฑ ุจูุช ุจูุฌุงุญ!")

    async def send_report(self, message):
        """ุฅุฑุณุงู ุชูุฑูุฑ ุฅูู ุงูููุงุฉ ุงููุญุฏุฏุฉ"""
        try:
            await self.client.send_message(self.report_channel, message)
        except Exception as e:
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - ูุดู ูู ุฅุฑุณุงู ุงูุชูุฑูุฑ: {e}")

    async def get_all_groups(self):
        """ุงูุญุตูู ุนูู ุฌููุน ุงููุฌููุนุงุช"""
        try:
            dialogs = await self.client.get_dialogs()
            groups = [dialog for dialog in dialogs if dialog.is_group]
            await self.send_report(f"๐ ุชู ุฌูุจ {len(groups)} ูุฌููุนุฉ ูุชุงุญุฉ ูููุดุฑ")
            return groups
        except Exception as e:
            error_msg = f"ุฎุทุฃ ูู ุงูุญุตูู ุนูู ุงููุฌููุนุงุช: {e}"
            await self.send_report(f"โ {error_msg}")
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
            return []

    async def publish_message(self):
        """ูุดุฑ ุฑุณุงูุฉ ูู ุฌููุน ุงููุฌููุนุงุช"""
        groups = await self.get_all_groups()
        if not groups:
            msg = "โ๏ธ ูุง ุชูุฌุฏ ูุฌููุนุงุช ูุชุงุญุฉ ูููุดุฑ"
            await self.send_report(msg)
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {msg}")
            return

        text = random.choice(BIO_TEXTS)
        success_count = 0
        
        for group in groups:
            try:
                await self.client.send_message(group.id, text)
                success_count += 1
                report_msg = f"๐ข ุชู ุงููุดุฑ ูู {group.title}"
                await self.send_report(report_msg)
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {report_msg}")
                await asyncio.sleep(random.uniform(5, 15))
            except Exception as e:
                error_msg = f"ุฎุทุฃ ูู ุงููุดุฑ ูู {group.title}: {e}"
                await self.send_report(f"โ {error_msg}")
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
                await asyncio.sleep(30)
        
        summary = f"๐ ููุฎุต ูุดุฑ ุงูุจุงูู: {success_count}/{len(groups)} ูุฌููุนุฉ"
        await self.send_report(summary)
        print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {summary}")

    async def publish_links(self):
        """ูุดุฑ ุงูุฑูุงุจุท ูู ุฌููุน ุงููุฌููุนุงุช"""
        groups = await self.get_all_groups()
        if not groups:
            msg = "โ๏ธ ูุง ุชูุฌุฏ ูุฌููุนุงุช ูุชุงุญุฉ ููุดุฑ ุงูุฑูุงุจุท"
            await self.send_report(msg)
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {msg}")
            return

        success_count = 0
        
        for group in groups:
            try:
                # ูุดุฑ ุงูุฑุงุจุท ุงูุฃูู ูุน ูุต ุนุดูุงุฆู
                link = LINKS[0]
                text = random.choice(LINK_TEXTS_1)
                await self.client.send_message(group.id, f"{text}\n{link}")
                report_msg = f"๐ ุชู ูุดุฑ ุฑุงุจุท ุงูุญุตุฑูุงุช ูู {group.title}"
                await self.send_report(report_msg)
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {report_msg}")
                await asyncio.sleep(random.uniform(5, 15))
                
                # ูุดุฑ ุงูุฑุงุจุท ุงูุซุงูู ูุน ูุต ุนุดูุงุฆู
                link = LINKS[1]
                text = random.choice(LINK_TEXTS_2)
                await self.client.send_message(group.id, f"{text}\n{link}")
                report_msg = f"๐ ุชู ูุดุฑ ุฑุงุจุท ุงูููุงุทุน ูู {group.title}"
                await self.send_report(report_msg)
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {report_msg}")
                await asyncio.sleep(random.uniform(5, 15))
                
                success_count += 1
            except Exception as e:
                error_msg = f"ุฎุทุฃ ูู ูุดุฑ ุงูุฑูุงุจุท ูู {group.title}: {e}"
                await self.send_report(f"โ {error_msg}")
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
                await asyncio.sleep(30)
        
        summary = f"๐ ููุฎุต ูุดุฑ ุงูุฑูุงุจุท: {success_count}/{len(groups)} ูุฌููุนุฉ"
        await self.send_report(summary)
        print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {summary}")

    async def schedule_publishing(self):
        """ุฌุฏููุฉ ุงููุดุฑ ุงูุชููุงุฆู"""
        while self.is_running:
            try:
                await self.publish_message()
                msg = f"โณ ุงูุชุธุงุฑ {self.publish_interval//3600} ุณุงุนุฉ ูููุดุฑ ุงูุชุงูู"
                await self.send_report(msg)
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {msg}")
                await asyncio.sleep(self.publish_interval)
            except Exception as e:
                error_msg = f"ุฎุทุฃ ูู ุฌุฏููุฉ ุงููุดุฑ: {e}"
                await self.send_report(f"โ {error_msg}")
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
                await asyncio.sleep(60)

    async def schedule_links_publishing(self):
        """ุฌุฏููุฉ ูุดุฑ ุงูุฑูุงุจุท"""
        while self.is_running:
            try:
                await self.publish_links()
                msg = f"โณ ุงูุชุธุงุฑ {self.links_publish_interval//3600} ุณุงุนุฉ ููุดุฑ ุงูุฑูุงุจุท ุงูุชุงูู"
                await self.send_report(msg)
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {msg}")
                await asyncio.sleep(self.links_publish_interval)
            except Exception as e:
                error_msg = f"ุฎุทุฃ ูู ุฌุฏููุฉ ูุดุฑ ุงูุฑูุงุจุท: {e}"
                await self.send_report(f"โ {error_msg}")
                print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
                await asyncio.sleep(60)

    async def run(self):
        """ุชุดุบูู ุงูุจูุช"""
        await self.initialize()
        
        # ุจุฏุก ุงูููุงู ูู ุงูุฎูููุฉ
        asyncio.create_task(self.schedule_publishing())
        asyncio.create_task(self.schedule_links_publishing())
        
        # ุงุณุชูุฑุงุฑ ุงูุชุดุบูู ุญุชู ูุชู ุฅููุงูู
        while self.is_running:
            await asyncio.sleep(3600)

async def main():
    poster = AutoPoster()
    while True:
        try:
            await poster.run()
        except Exception as e:
            error_msg = f"ุญุฏุซ ุฎุทุฃ ุฌุณูู: {e}"
            await poster.send_report(f"โ {error_msg}")
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - {error_msg}")
            print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช ุจุนุฏ 60 ุซุงููุฉ...")
            await asyncio.sleep(60)

if __name__ == '__main__':
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - ุชู ุฅููุงู ุงูุจุฑูุงูุฌ")
        # ูุง ูููู ุฅุฑุณุงู ุชูุฑูุฑ ููุง ูุฃู ุงูุจุฑูุงูุฌ ูู ุญุงูุฉ ุฅููุงู
